<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChatBot - Consulta de Reportes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilo para men√∫ desplegable */
        .dropdown-menu {
            min-width: 150px;
        }
        
        @media (min-width: 992px) {
            .sidebar-width {
                width: 280px;
                flex-shrink: 0;
            }
        }

        /* Modo oscuro */
        body.dark-mode {
            background-color: #121212 !important;
            color: #f8f9fa;
        }

        body.dark-mode .card-header,
        body.dark-mode .navbar {
            background-color: #333333 !important;
            color: #ffffff !important;
        }

        body.dark-mode .card-body {
            background-color: #2c2c2c !important;
        }

        body.dark-mode .card-footer {
            background-color: #1e1e1e !important;
            border-top-color: #333 !important;
        }
        
        body.dark-mode .sidebar-bg {
             background-color: #1e1e1e !important;
             border-right-color: #333 !important;
             color: #f8f9fa;
        }

        body.dark-mode .form-control {
            background-color: #2c2c2c;
            color: #ffffff;
            border-color: #555555;
        }

        body.dark-mode .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        body.dark-mode .alert {
            background-color: #3a3a3a !important;
            border-color: #555555;
            color: #ffffff !important;
        }

        body.dark-mode .bot-msg {
            background-color: #e0e0e0 !important;
            color: #000000 !important;
        }

        body.dark-mode .user-msg {
            background-color: #0d6efd !important;
            color: #ffffff !important;
        }
    </style>
</head>

<body class="d-flex flex-column vh-100">

    <!-- 1. HEADER (SOLO PARA M√ìVIL) -->
    <header class="navbar bg-primary text-white p-2 d-lg-none shadow-sm">
        <div class="d-flex align-items-center">
            <button class="btn btn-light btn-sm me-2" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
                ‚ò∞
            </button>
            <span class="navbar-brand text-white mb-0 h1">SenaSoft Comunity IA</span>
        </div>

        <!-- Men√∫ de Configuraci√≥n (para m√≥vil) -->
        <div class="dropdown">
            <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="configMenuButtonMobile"
                data-bs-toggle="dropdown" aria-expanded="false">
                ‚öôÔ∏è
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="configMenuButtonMobile" id="configMenuMobile">
                <li><a class="dropdown-item" href="#" id="modoOscuroMobile">Modo oscuro</a></li>
                <li><a class="dropdown-item" href="#" id="limpiarChatMobile">Limpiar chat</a></li>
                <li><hr class="dropdown-divider" id="csvDividerMobile" style="display: none;"></li>
                <li>
                    <a class="dropdown-item" href="#" id="cambiarArchivoMobile" style="display: none;">
                        Cargado: <span class="badge bg-secondary" id="nombreArchivoCargadoMobile"></span>
                    </a>
                </li>
            </ul>
        </div>
    </header>

    <!-- 2. CONTENEDOR PRINCIPAL (SIDEBAR + CHAT) -->
    <div class="d-flex flex-grow-1 overflow-hidden">

        <!-- 2a. SIDEBAR (MEN√ö LATERAL) -->
        <div class="offcanvas-lg offcanvas-start bg-light border-end sidebar-width sidebar-bg" tabindex="-1"
             id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
            
            <!-- Encabezado del Offcanvas (solo visible en m√≥vil) -->
            <div class="offcanvas-header d-lg-none">
                <h5 class="offcanvas-title" id="sidebarMenuLabel">Men√∫</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Cerrar"></button>
            </div>

            <!-- Cuerpo del Men√∫ -->
            <div class="offcanvas-body d-flex flex-column">
                <!-- Botones de acci√≥n -->
                <div class="d-grid gap-2 my-3">
                    <button class="btn btn-primary" id="generarInformePDFSidebar">üìÑ Generar informe PDF</button>
                    <button class="btn btn-secondary" id="vistaInformesSidebar">üìä Vista de informes graficados</button>
                </div>

                <!-- Historial de chats quemados -->
                <div class="mt-4">
                    <h6 class="text-muted">Historial de chats</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item py-1">üë§ Usuario: ¬øCu√°l es la situaci√≥n de salud en Pereira?</li>
                        <li class="list-group-item py-1">ü§ñ Bot: Incremento en enfermedades cr√≥nicas no transmisibles.</li>
                        <li class="list-group-item py-1">üë§ Usuario: Genera un resumen ejecutivo de seguridad</li>
                        <li class="list-group-item py-1">ü§ñ Bot: Informe generado: mejora del 15% en seguridad.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 2b. CONTENIDO PRINCIPAL (CHAT) -->
        <main class="d-flex flex-column flex-grow-1" style="min-width: 0;">

            <!-- Encabezado del Chat (SOLO PARA PC) -->
            <div class="card-header text-white bg-primary d-none d-lg-flex justify-content-between align-items-center flex-shrink-0">
                ü§ñ SenaSoft Comunity IA ü§ñ

                <!-- Men√∫ de Configuraci√≥n (para PC) -->
                <div class="dropdown">
                    <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="configMenuButton"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        ‚öôÔ∏è
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="configMenuButton" id="configMenu">
                        <li><a class="dropdown-item" href="#" id="modoOscuro">Modo oscuro</a></li>
                        <li><a class="dropdown-item" href="#" id="limpiarChat">Limpiar chat</a></li>
                        <li>
                            <hr class="dropdown-divider" id="csvDivider" style="display: none;">
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" id="cambiarArchivo" style="display: none;">
                                Cargado: <span class="badge bg-secondary" id="nombreArchivoCargado"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Cuerpo del Chat (Scrollable) -->
            <div class="card-body d-flex flex-column bg-body-tertiary p-3 overflow-auto" id="chatBody">
                <div class="alert alert-secondary p-2 mb-2">
                    ¬°Hola! üëã Soy tu asistente virtual.
                    Pregunta por la situaci√≥n de una ciudad y categor√≠a, por ejemplo:
                    <br><b>"¬øC√≥mo est√° la seguridad en Pereira?"</b>
                </div>
            </div>

            <!-- Pie del Chat (Input) -->
            <div class="card-footer bg-light border-top p-3 flex-shrink-0">
                <div class="mb-2" id="csvUploadContainer">
                    <input type="file" id="csvFile" class="form-control" accept=".csv" />
                    <button class="btn btn-success mt-2 w-100" id="cargarCSV">Cargar CSV</button>
                </div>

                <div class="input-group mt-2">
                    <input type="text" id="mensaje" class="form-control" placeholder="Escribe tu mensaje aqu√≠..."
                        aria-label="Mensaje del usuario" disabled />
                    <button class="btn btn-primary" id="consultar" disabled>Enviar</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de notificaci√≥n -->
    <div class="modal fade" id="modalNotificacion" tabindex="-1" aria-labelledby="modalNotificacionLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalNotificacionLabel">Notificaci√≥n</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Mensaje din√°mico -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>

</html>
